<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Bot Control Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0088cc;
            --primary-dark: #006699;
            --secondary: #ff6b6b;
            --success: #00cc66;
            --warning: #ffaa00;
            --dark: #1a1a2e;
            --darker: #16213e;
            --light: #e6e6e6;
            --accent: #00d4ff;
            --card-bg: rgba(255, 255, 255, 0.05);
            --card-border: rgba(255, 255, 255, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark), var(--darker));
            color: var(--light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header Styles */
        header {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            border-bottom: 1px solid var(--card-border);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            font-size: 2.5rem;
            color: var(--primary);
            filter: drop-shadow(0 0 10px var(--primary));
        }
        
        .logo-text {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        /* Login Modal */
        .login-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .login-box {
            background: linear-gradient(145deg, var(--dark), var(--darker));
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
            transform-style: preserve-3d;
            transform: perspective(1000px) rotateX(5deg);
            border: 1px solid var(--card-border);
        }
        
        .login-box::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, var(--primary), var(--accent), var(--secondary));
            z-index: -1;
            border-radius: 22px;
            filter: blur(10px);
            opacity: 0.5;
        }
        
        .login-title {
            font-size: 1.8rem;
            margin-bottom: 30px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .input-group {
            margin-bottom: 20px;
            text-align: left;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .input-group input {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: var(--light);
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(0, 136, 204, 0.5);
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .login-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 136, 204, 0.4);
        }
        
        /* Main Content */
        .main-content {
            display: none;
            padding: 40px 0;
            flex: 1;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--card-border);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
        }
        
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }
        
        .card-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .card-content {
            font-size: 1rem;
            line-height: 1.6;
        }
        
        .bot-config {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .config-group {
            margin-bottom: 15px;
            position: relative;
        }
        
        .config-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--accent);
        }
        
        .config-input {
            width: 100%;
            padding: 10px 40px 10px 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: var(--light);
            font-family: monospace;
        }
        
        .config-status {
            position: absolute;
            right: 10px;
            top: 35px;
            font-size: 1.2rem;
        }
        
        .status-valid {
            color: var(--success);
        }
        
        .status-invalid {
            color: var(--secondary);
        }
        
        .save-config-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            background: var(--primary);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            width: 100%;
            justify-content: center;
        }
        
        .save-config-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }
        
        .bot-info {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .bot-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .bot-info-item:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }
        
        .bot-info-label {
            font-weight: 600;
            color: var(--accent);
        }
        
        .bot-info-value {
            font-family: monospace;
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 8px;
            border-radius: 5px;
        }
        
        .stats {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .stat {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 15px;
            border-radius: 10px;
            flex: 1;
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Message Form */
        .message-form {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--card-border);
            margin-bottom: 40px;
        }
        
        .form-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-group textarea {
            width: 100%;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: var(--light);
            font-size: 1rem;
            min-height: 150px;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(0, 136, 204, 0.5);
        }
        
        .send-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .send-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 136, 204, 0.4);
        }
        
        .send-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Groups Management */
        .groups-management {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--card-border);
            margin-bottom: 40px;
        }
        
        .groups-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .groups-title {
            font-size: 1.5rem;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--accent));
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(45deg, var(--success), var(--accent));
            color: white;
        }
        
        .btn-secondary {
            background: rgba(0, 0, 0, 0.3);
            color: var(--light);
        }
        
        .btn-danger {
            background: linear-gradient(45deg, var(--secondary), #ff8e8e);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .groups-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        .groups-table th, .groups-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .groups-table th {
            color: var(--accent);
            font-weight: 600;
        }
        
        .group-id-input {
            width: 100%;
            padding: 10px 40px 10px 10px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: var(--light);
            font-family: monospace;
        }
        
        .group-status {
            position: absolute;
            right: 10px;
            top: 35px;
            font-size: 1.2rem;
        }
        
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status.active {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }
        
        .status.inactive {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0000;
        }
        
        .status.valid {
            background: rgba(0, 255, 0, 0.2);
            color: #00ff00;
        }
        
        .status.invalid {
            background: rgba(255, 0, 0, 0.2);
            color: #ff0000;
        }
        
        .delete-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .delete-btn:hover {
            background: #ff5252;
            transform: scale(1.05);
        }
        
        .add-group-form {
            background: rgba(0, 0, 0, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            position: relative;
        }
        
        .form-row input, .form-row textarea {
            flex: 1;
            padding: 12px 40px 12px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: var(--light);
            font-family: monospace;
        }
        
        .form-row textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-help {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 5px;
        }

        /* PERBAIKAN: Validation Messages */
        .validation-message {
            font-size: 0.8rem;
            margin-top: 5px;
            padding: 8px;
            border-radius: 5px;
            display: none;
        }
        
        .validation-success {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }
        
        .validation-error {
            background: rgba(255, 0, 0, 0.1);
            color: #ff4444;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }
        
        .bulk-results {
            margin-top: 15px;
            padding: 15px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            display: none;
        }
        
        .result-item {
            padding: 5px;
            margin: 3px 0;
            border-radius: 4px;
            font-size: 0.85rem;
        }
        
        .result-success {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
        }
        
        .result-error {
            background: rgba(255, 0, 0, 0.1);
            color: #ff4444;
        }
        
        .result-warning {
            background: rgba(255, 165, 0, 0.1);
            color: #ffaa00;
        }
        
        .group-preview {
            margin-top: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        
        .preview-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--accent);
        }
        
        /* Footer */
        footer {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px 0;
            text-align: center;
            border-top: 1px solid var(--card-border);
            margin-top: auto;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            background: var(--success);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.error {
            background: var(--secondary);
        }
        
        .notification.warning {
            background: var(--warning);
        }
        
        /* Diagnosis Panel */
        .diagnosis-panel {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--card-border);
            margin-bottom: 40px;
        }
        
        .diagnosis-item {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .diagnosis-icon {
            font-size: 1.5rem;
            width: 40px;
            text-align: center;
        }
        
        .diagnosis-content {
            flex: 1;
        }
        
        .diagnosis-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--accent);
        }
        
        .diagnosis-desc {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        .diagnosis-status {
            font-weight: 600;
        }
        
        .status-good {
            color: var(--success);
        }
        
        .status-bad {
            color: var(--secondary);
        }
        
        .status-warning {
            color: var(--warning);
        }
        
        /* Test Connection Button */
        .test-connection {
            margin-top: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            text-align: center;
        }
        
        .test-btn {
            padding: 8px 15px;
            border: none;
            border-radius: 6px;
            background: var(--warning);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            margin: 0 auto;
        }
        
        .test-btn:hover {
            background: #e69900;
        }
        
        /* FITUR BARU: Search and Filter */
        .search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: var(--light);
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255, 255, 255, 0.5);
        }
        
        .filter-select {
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: var(--light);
            min-width: 150px;
        }
        
        /* FITUR BARU: Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .pagination-btn {
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .pagination-btn:hover {
            background: var(--primary);
        }
        
        .pagination-btn.active {
            background: var(--primary);
        }
        
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* FITUR BARU: Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* 3D Effects */
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 136, 204, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 136, 204, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 136, 204, 0); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .groups-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            
            .action-buttons {
                width: 100%;
                justify-content: space-between;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .search-filter {
                flex-direction: column;
            }
            
            .search-box {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notification-text">Operasi berhasil!</span>
    </div>
    
    <!-- Login Modal -->
    <div class="login-modal" id="loginModal">
        <div class="login-box floating">
            <h2 class="login-title">Bot Control Panel</h2>
            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Masukkan password">
            </div>
            <button class="login-btn" id="loginBtn">
                <i class="fas fa-sign-in-alt"></i> Login
            </button>
        </div>
    </div>
    
    <!-- Main Content (Hidden until login) -->
    <div class="main-content" id="mainContent">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <div class="logo-icon">ü§ñ</div>
                        <div class="logo-text">Telegram Bot Control</div>
                    </div>
                    <div class="user-info">
                        <span>Admin Panel</span>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="container">
            <!-- Dashboard Stats -->
            <div class="dashboard">
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-robot"></i> Konfigurasi Bot
                    </h3>
                    <div class="bot-config">
                        <div class="config-group">
                            <label for="botId">ID Bot</label>
                            <input type="text" id="botId" class="config-input" placeholder="Masukkan ID Bot (contoh: 8320390995)" value="8320390995">
                            <div class="config-status" id="botIdStatus">
                                <i class="fas fa-question-circle"></i>
                            </div>
                        </div>
                        <div class="config-group">
                            <label for="botToken">Token Bot</label>
                            <input type="text" id="botToken" class="config-input" placeholder="Masukkan Token Bot" value="8320390995:AAF-d8kZMPJVGBGhPL3TwTr8s59FUM6ugQM">
                            <div class="config-status" id="botTokenStatus">
                                <i class="fas fa-question-circle"></i>
                            </div>
                        </div>
                        
                        <div class="test-connection">
                            <button class="test-btn" id="testConnectionBtn">
                                <i class="fas fa-plug"></i> Test Koneksi Bot
                            </button>
                            <div id="testResult" style="margin-top: 10px; font-size: 0.9rem;"></div>
                        </div>
                        
                        <button class="save-config-btn" id="saveConfigBtn">
                            <i class="fas fa-save"></i> Simpan Konfigurasi
                        </button>
                    </div>
                    <div class="stats">
                        <div class="stat">
                            <div class="stat-value" id="groupsCount">0</div>
                            <div class="stat-label">Grup Terdaftar</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value" id="activeGroupsCount">0</div>
                            <div class="stat-label">Grup Aktif</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3 class="card-title">
                        <i class="fas fa-list-check"></i> Fitur Bot
                    </h3>
                    <div class="card-content">
                        <ul>
                            <li>Kirim pesan ke semua grup</li>
                            <li>Multi tambah grup dengan mudah</li>
                            <li>Validasi konfigurasi bot real-time</li>
                            <li>Validasi ID grup otomatis</li>
                            <li>Diagnosis masalah pengiriman</li>
                            <li>Pencarian dan filter grup</li>
                        </ul>
                    </div>
                </div>
                
                <div class="card pulse">
                    <h3 class="card-title">
                        <i class="fas fa-triangle-exclamation"></i> Peringatan
                    </h3>
                    <div class="card-content">
                        <p>Pastikan bot sudah menjadi admin di grup sebelum mengirim pesan. Bot hanya dapat mengirim pesan ke grup yang telah menambahkan bot sebagai admin dan memiliki izin posting.</p>
                    </div>
                </div>
            </div>

            <!-- Diagnosis Panel -->
            <div class="diagnosis-panel">
                <h3 class="card-title">
                    <i class="fas fa-stethoscope"></i> Diagnosis Sistem
                </h3>
                <div class="diagnosis-item">
                    <div class="diagnosis-icon">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="diagnosis-content">
                        <div class="diagnosis-title">Konfigurasi Bot</div>
                        <div class="diagnosis-desc">Status ID Bot dan Token</div>
                    </div>
                    <div class="diagnosis-status" id="configStatus">Memeriksa...</div>
                </div>
                <div class="diagnosis-item">
                    <div class="diagnosis-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="diagnosis-content">
                        <div class="diagnosis-title">Grup Valid</div>
                        <div class="diagnosis-desc">Jumlah grup dengan format ID yang benar</div>
                    </div>
                    <div class="diagnosis-status" id="validGroupsStatus">Memeriksa...</div>
                </div>
                <div class="diagnosis-item">
                    <div class="diagnosis-icon">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="diagnosis-content">
                        <div class="diagnosis-title">Hak Akses Bot</div>
                        <div class="diagnosis-desc">Status admin bot di grup</div>
                    </div>
                    <div class="diagnosis-status" id="permissionsStatus">Memeriksa...</div>
                </div>
                <div class="diagnosis-item">
                    <div class="diagnosis-icon">
                        <i class="fas fa-paper-plane"></i>
                    </div>
                    <div class="diagnosis-content">
                        <div class="diagnosis-title">Sistem Pengiriman</div>
                        <div class="diagnosis-desc">Kesiapan mengirim pesan</div>
                    </div>
                    <div class="diagnosis-status" id="sendStatus">Memeriksa...</div>
                </div>
            </div>
            
            <!-- Message Form -->
            <div class="message-form">
                <h3 class="form-title">
                    <i class="fas fa-paper-plane"></i> Kirim Pesan ke Semua Grup
                </h3>
                <div class="form-group">
                    <label for="message">Pesan</label>
                    <textarea id="message" placeholder="Tulis pesan yang ingin dikirim ke semua grup..."></textarea>
                </div>
                <button class="send-btn" id="sendBtn">
                    <i class="fas fa-paper-plane"></i> Kirim Pesan ke Semua Grup
                </button>
            </div>
            
            <!-- Groups Management - BAGIAN YANG DIPERBAIKI -->
            <div class="groups-management">
                <div class="groups-header">
                    <h3 class="groups-title">
                        <i class="fas fa-users"></i> Kelola Daftar Grup
                    </h3>
                    <div class="action-buttons">
                        <button class="btn btn-success" id="multiAddGroupBtn">
                            <i class="fas fa-layer-group"></i> Multi Tambah Grup
                        </button>
                        <button class="btn btn-primary" id="addGroupBtn">
                            <i class="fas fa-plus"></i> Tambah Grup
                        </button>
                        <button class="btn btn-secondary" id="refreshBtn">
                            <i class="fas fa-rotate"></i> Refresh Status
                        </button>
                    </div>
                </div>
                
                <!-- FITUR BARU: Search and Filter -->
                <div class="search-filter">
                    <div class="search-box">
                        <input type="text" id="searchInput" class="search-input" placeholder="Cari grup berdasarkan ID...">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    <select id="statusFilter" class="filter-select">
                        <option value="all">Semua Status</option>
                        <option value="active">Aktif</option>
                        <option value="inactive">Tidak Aktif</option>
                        <option value="valid">Valid</option>
                        <option value="invalid">Invalid</option>
                    </select>
                    <select id="sortBy" class="filter-select">
                        <option value="id">Urutkan berdasarkan ID</option>
                        <option value="status">Urutkan berdasarkan Status</option>
                        <option value="lastResult">Urutkan berdasarkan Hasil</option>
                    </select>
                </div>
                
                <table class="groups-table">
                    <thead>
                        <tr>
                            <th>ID Grup</th>
                            <th>Validitas ID</th>
                            <th>Status Bot</th>
                            <th>Hasil Terakhir</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="groupsTableBody">
                        <!-- Data akan diisi oleh JavaScript -->
                    </tbody>
                </table>
                
                <!-- FITUR BARU: Pagination -->
                <div class="pagination" id="pagination">
                    <!-- Pagination akan diisi oleh JavaScript -->
                </div>
                
                <!-- FORM TAMBAH GRUP SINGLE - DIPERBAIKI -->
                <div class="add-group-form" id="addGroupForm" style="display: none;">
                    <h4><i class="fas fa-plus-circle"></i> Tambah Grup Baru</h4>
                    <div class="form-group">
                        <label for="newGroupId">ID Grup</label>
                        <div class="form-row">
                            <input type="text" id="newGroupId" placeholder="Masukkan ID Grup (contoh: -1003189125260)">
                            <div class="group-status" id="newGroupIdStatus">
                                <i class="fas fa-question-circle"></i>
                            </div>
                        </div>
                        <!-- PERBAIKAN: Validation Message -->
                        <div class="validation-message" id="singleGroupValidation"></div>
                        <p class="form-help">ID grup harus dimulai dengan -100 dan panjang 14 karakter (contoh: -1003189125260)</p>
                        
                        <!-- PERBAIKAN: Group Preview -->
                        <div class="group-preview" id="singleGroupPreview" style="display: none;">
                            <div class="preview-title">Preview Grup:</div>
                            <div>ID: <span id="previewGroupId"></span></div>
                            <div>Panjang: <span id="previewGroupLength"></span> karakter</div>
                            <div>Status: <span id="previewGroupStatus" class="status valid">Akan ditambahkan sebagai aktif</span></div>
                        </div>
                    </div>
                    <div class="form-row">
                        <button class="btn btn-primary" id="saveGroupBtn">
                            <i class="fas fa-save"></i> Simpan Grup
                        </button>
                        <button class="btn btn-secondary" id="cancelAddBtn">
                            <i class="fas fa-times"></i> Batal
                        </button>
                    </div>
                </div>
                
                <!-- FORM MULTI TAMBAH GRUP - DIPERBAIKI -->
                <div class="add-group-form" id="multiAddGroupForm" style="display: none;">
                    <h4><i class="fas fa-layer-group"></i> Multi Tambah Grup</h4>
                    <div class="form-group">
                        <label for="multiGroupIds">Masukkan ID Grup (satu per baris atau dipisahkan spasi)</label>
                        <textarea id="multiGroupIds" placeholder="Contoh:
-1003189125260
-1003189125261
-1003189125262
-1003189125263"></textarea>
                        <!-- PERBAIKAN: Validation Message -->
                        <div class="validation-message" id="multiGroupValidation"></div>
                        <p class="form-help">Anda dapat memasukkan beberapa ID grup sekaligus dengan memisahkannya menggunakan spasi atau enter. Format: -100xxxxxxxxxx (14 karakter)</p>
                        
                        <!-- PERBAIKAN: Group Preview -->
                        <div class="group-preview" id="multiGroupPreview" style="display: none;">
                            <div class="preview-title">Summary:</div>
                            <div>Total ID: <span id="previewTotalIds">0</span></div>
                            <div>Valid: <span id="previewValidIds" style="color: #00ff00">0</span></div>
                            <div>Duplikat: <span id="previewDuplicateIds" style="color: #ffaa00">0</span></div>
                            <div>Invalid: <span id="previewInvalidIds" style="color: #ff4444">0</span></div>
                        </div>
                    </div>
                    
                    <!-- PERBAIKAN: Results Display -->
                    <div class="bulk-results" id="bulkResults">
                        <div class="preview-title">Hasil Proses:</div>
                        <div id="bulkResultsContent"></div>
                    </div>
                    
                    <div class="form-row">
                        <button class="btn btn-success" id="saveMultiGroupBtn">
                            <i class="fas fa-save"></i> Simpan Semua Grup Valid
                        </button>
                        <button class="btn btn-secondary" id="cancelMultiAddBtn">
                            <i class="fas fa-times"></i> Batal
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <div class="container">
                <p>Telegram Bot Control Panel &copy; 2026 - All rights reserved</p>
            </div>
        </footer>
    </div>
    
    <script>
        // Data Grup - Disimpan di localStorage
        let groups = [];
        let botConfig = {
            id: '',
            token: '',
            isValid: false
        };

        // FITUR BARU: Pagination dan Filter
        let currentPage = 1;
        const itemsPerPage = 10;
        let filteredGroups = [];
        let searchQuery = '';
        let statusFilter = 'all';
        let sortBy = 'id';

        // Inisialisasi data
        function initializeData() {
            const savedGroups = localStorage.getItem('telegramBotGroups');
            const savedConfig = localStorage.getItem('telegramBotConfig');
            
            if (savedGroups) {
                groups = JSON.parse(savedGroups);
            } else {
                // Data default jika belum ada
                groups = [
                    { id: "-1003189125260", status: "active", lastResult: "", isValid: true },
                    { id: "-1003189125261", status: "active", lastResult: "", isValid: true },
                    { id: "-1003189125262", status: "inactive", lastResult: "Bot bukan admin", isValid: true },
                    { id: "-1003189125263", status: "active", lastResult: "", isValid: true }
                ];
                saveGroups();
            }

            if (savedConfig) {
                botConfig = JSON.parse(savedConfig);
                document.getElementById('botId').value = botConfig.id;
                document.getElementById('botToken').value = botConfig.token;
                validateBotConfig();
            } else {
                // Set default values
                document.getElementById('botId').value = "8320390995";
                document.getElementById('botToken').value = "8320390995:AAF-d8kZMPJVGBGhPL3TwTr8s59FUM6ugQM";
                validateBotConfig();
            }

            updateGroupsCount();
            applyFiltersAndSort();
            populateGroupsTable();
            runDiagnosis();
        }

        // Validasi konfigurasi bot
        function validateBotConfig() {
            const botId = document.getElementById('botId').value.trim();
            const botToken = document.getElementById('botToken').value.trim();
            
            const botIdStatus = document.getElementById('botIdStatus');
            const botTokenStatus = document.getElementById('botTokenStatus');
            
            // Validasi ID Bot
            if (botId && /^\d+$/.test(botId) && botId.length >= 8) {
                botIdStatus.innerHTML = '<i class="fas fa-check-circle status-valid"></i>';
                botIdStatus.title = 'ID Bot valid';
            } else {
                botIdStatus.innerHTML = '<i class="fas fa-times-circle status-invalid"></i>';
                botIdStatus.title = 'ID Bot harus angka dan minimal 8 digit';
            }
            
            // Validasi Token Bot
            if (botToken && botToken.includes(':') && botToken.length > 20) {
                botTokenStatus.innerHTML = '<i class="fas fa-check-circle status-valid"></i>';
                botTokenStatus.title = 'Token Bot valid';
            } else {
                botTokenStatus.innerHTML = '<i class="fas fa-times-circle status-invalid"></i>';
                botTokenStatus.title = 'Format token tidak valid';
            }
            
            // Update botConfig
            botConfig.id = botId;
            botConfig.token = botToken;
            botConfig.isValid = (botId && botToken && /^\d+$/.test(botId) && botToken.includes(':'));
        }

        // ==================== PERBAIKAN: Validasi ID Grup yang Lebih Akurat ====================
        function validateGroupId(groupId) {
            if (!groupId) {
                return { 
                    isValid: false, 
                    message: "‚ùå ID Grup tidak boleh kosong" 
                };
            }
            
            // Cek format dasar
            if (!groupId.startsWith('-100')) {
                return { 
                    isValid: false, 
                    message: "‚ùå ID Grup harus dimulai dengan -100" 
                };
            }
            
            // PERBAIKAN: Cek panjang yang benar - 14 karakter termasuk tanda minus
            if (groupId.length !== 14) {
                return { 
                    isValid: false, 
                    message: `‚ùå ID Grup harus tepat 14 karakter termasuk '-' (saat ini: ${groupId.length})` 
                };
            }
            
            // Cek hanya angka setelah -100
            const numericPart = groupId.substring(4); // Ambil bagian setelah -100
            if (!/^\d{10}$/.test(numericPart)) {
                return { 
                    isValid: false, 
                    message: "‚ùå Setelah -100 harus berupa 10 digit angka" 
                };
            }
            
            // Cek duplikat
            if (groups.some(group => group.id === groupId)) {
                return { 
                    isValid: false, 
                    message: "‚ö†Ô∏è Grup dengan ID ini sudah ada dalam daftar" 
                };
            }
            
            return { 
                isValid: true, 
                message: "‚úÖ ID Grup valid dan siap ditambahkan" 
            };
        }

        // Simpan data ke localStorage
        function saveGroups() {
            localStorage.setItem('telegramBotGroups', JSON.stringify(groups));
        }

        function saveConfig() {
            localStorage.setItem('telegramBotConfig', JSON.stringify(botConfig));
        }

        // Update jumlah grup
        function updateGroupsCount() {
            const totalGroups = groups.length;
            const activeGroups = groups.filter(group => group.status === 'active').length;
            const validGroups = groups.filter(group => group.isValid).length;
            
            document.getElementById('groupsCount').textContent = totalGroups;
            document.getElementById('activeGroupsCount').textContent = activeGroups;
            
            return { totalGroups, activeGroups, validGroups };
        }

        // Tampilkan notifikasi
        function showNotification(message, isError = false, isWarning = false) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            
            notificationText.textContent = message;
            
            notification.classList.remove('error', 'warning');
            if (isError) {
                notification.classList.add('error');
            } else if (isWarning) {
                notification.classList.add('warning');
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Diagnosis sistem
        function runDiagnosis() {
            const { totalGroups, activeGroups, validGroups } = updateGroupsCount();
            
            // Status Konfigurasi Bot
            if (botConfig.isValid) {
                document.getElementById('configStatus').innerHTML = '<span class="status-good">‚úì Terkonfigurasi dengan benar</span>';
            } else {
                document.getElementById('configStatus').innerHTML = '<span class="status-bad">‚úó Konfigurasi tidak valid</span>';
            }

            // Status Grup Valid
            if (validGroups > 0) {
                document.getElementById('validGroupsStatus').innerHTML = `<span class="status-good">‚úì ${validGroups}/${totalGroups} grup valid</span>`;
            } else {
                document.getElementById('validGroupsStatus').innerHTML = '<span class="status-bad">‚úó Tidak ada grup valid</span>';
            }

            // Status Permissions
            if (activeGroups > 0) {
                document.getElementById('permissionsStatus').innerHTML = `<span class="status-good">‚úì ${activeGroups} grup aktif</span>`;
            } else {
                document.getElementById('permissionsStatus').innerHTML = '<span class="status-bad">‚úó Tidak ada grup aktif</span>';
            }

            // Status Pengiriman
            if (botConfig.isValid && activeGroups > 0) {
                document.getElementById('sendStatus').innerHTML = '<span class="status-good">‚úì Siap mengirim</span>';
            } else {
                document.getElementById('sendStatus').innerHTML = '<span class="status-bad">‚úó Tidak siap mengirim</span>';
            }
        }

        // Test koneksi bot
        async function testBotConnection() {
            const testResult = document.getElementById('testResult');
            const testBtn = document.getElementById('testConnectionBtn');
            
            if (!botConfig.isValid) {
                testResult.innerHTML = '<span style="color: #ff4444">‚ùå Konfigurasi bot tidak valid</span>';
                return;
            }

            testBtn.disabled = true;
            testBtn.innerHTML = '<div class="loading-spinner"></div> Testing...';
            testResult.innerHTML = '<span style="color: #ffaa00">üîÑ Menguji koneksi ke Telegram API...</span>';

            try {
                // Simulasi test koneksi ke Telegram Bot API
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // Simulasi hasil test (80% success rate)
                const isSuccess = Math.random() > 0.2;
                
                if (isSuccess) {
                    testResult.innerHTML = '<span style="color: #00ff00">‚úÖ Bot terhubung dengan Telegram API</span>';
                    showNotification('Koneksi bot berhasil!', false, false);
                } else {
                    testResult.innerHTML = '<span style="color: #ff4444">‚ùå Gagal terhubung ke Telegram API. Periksa token bot.</span>';
                    showNotification('Koneksi bot gagal! Periksa token.', true, false);
                }
            } catch (error) {
                testResult.innerHTML = `<span style="color: #ff4444">‚ùå Error: ${error.message}</span>`;
                showNotification('Terjadi error saat testing koneksi', true, false);
            } finally {
                testBtn.disabled = false;
                testBtn.innerHTML = '<i class="fas fa-plug"></i> Test Koneksi Bot';
            }
        }

        // ==================== PERBAIKAN: Validasi Real-time untuk Single Group ====================
        function validateSingleGroup() {
            const groupId = document.getElementById('newGroupId').value.trim();
            const statusElement = document.getElementById('newGroupIdStatus');
            const validationElement = document.getElementById('singleGroupValidation');
            const previewElement = document.getElementById('singleGroupPreview');
            
            const validation = validateGroupId(groupId);
            
            if (groupId === '') {
                statusElement.innerHTML = '<i class="fas fa-question-circle"></i>';
                validationElement.style.display = 'none';
                previewElement.style.display = 'none';
                return;
            }
            
            if (validation.isValid) {
                statusElement.innerHTML = '<i class="fas fa-check-circle status-valid"></i>';
                validationElement.innerHTML = validation.message;
                validationElement.className = 'validation-message validation-success';
                validationElement.style.display = 'block';
                
                // Show preview
                previewElement.style.display = 'block';
                document.getElementById('previewGroupId').textContent = groupId;
                document.getElementById('previewGroupLength').textContent = groupId.length;
            } else {
                statusElement.innerHTML = '<i class="fas fa-times-circle status-invalid"></i>';
                validationElement.innerHTML = validation.message;
                validationElement.className = 'validation-message validation-error';
                validationElement.style.display = 'block';
                previewElement.style.display = 'none';
            }
        }

        // ==================== PERBAIKAN: Validasi Real-time untuk Multi Group ====================
        function validateMultiGroups() {
            const multiGroupIdsText = document.getElementById('multiGroupIds').value.trim();
            const validationElement = document.getElementById('multiGroupValidation');
            const previewElement = document.getElementById('multiGroupPreview');
            const resultsElement = document.getElementById('bulkResults');
            
            if (multiGroupIdsText === '') {
                validationElement.style.display = 'none';
                previewElement.style.display = 'none';
                resultsElement.style.display = 'none';
                return;
            }
            
            // Parse group IDs
            const groupIds = multiGroupIdsText.split(/[\s\n]+/).filter(id => id.trim() !== '');
            
            if (groupIds.length === 0) {
                validationElement.innerHTML = '‚ùå Tidak ada ID grup yang dimasukkan';
                validationElement.className = 'validation-message validation-error';
                validationElement.style.display = 'block';
                previewElement.style.display = 'none';
                resultsElement.style.display = 'none';
                return;
            }
            
            let validCount = 0;
            let duplicateCount = 0;
            let invalidCount = 0;
            const validGroups = [];
            const duplicateGroups = [];
            const invalidGroups = [];
            
            // Analyze each group ID
            groupIds.forEach(groupId => {
                const trimmedId = groupId.trim();
                const validation = validateGroupId(trimmedId);
                
                if (validation.isValid) {
                    validCount++;
                    validGroups.push(trimmedId);
                } else if (validation.message.includes("sudah ada")) {
                    duplicateCount++;
                    duplicateGroups.push(trimmedId);
                } else {
                    invalidCount++;
                    invalidGroups.push({ id: trimmedId, reason: validation.message });
                }
            });
            
            // Update preview
            document.getElementById('previewTotalIds').textContent = groupIds.length;
            document.getElementById('previewValidIds').textContent = validCount;
            document.getElementById('previewDuplicateIds').textContent = duplicateCount;
            document.getElementById('previewInvalidIds').textContent = invalidCount;
            
            // Show validation message
            if (validCount > 0) {
                validationElement.innerHTML = `‚úÖ Ditemukan ${validCount} ID grup valid, ${duplicateCount} duplikat, ${invalidCount} invalid`;
                validationElement.className = 'validation-message validation-success';
            } else {
                validationElement.innerHTML = `‚ùå Tidak ada ID grup yang valid. ${duplicateCount} duplikat, ${invalidCount} invalid`;
                validationElement.className = 'validation-message validation-error';
            }
            validationElement.style.display = 'block';
            previewElement.style.display = 'block';
            
            // Show detailed results if there are issues
            if (invalidCount > 0 || duplicateCount > 0) {
                resultsElement.style.display = 'block';
                let resultsHTML = '';
                
                if (invalidCount > 0) {
                    resultsHTML += '<div class="result-error">ID Invalid:</div>';
                    invalidGroups.forEach(group => {
                        resultsHTML += `<div class="result-item result-error">${group.reason}</div>`;
                    });
                }
                
                if (duplicateCount > 0) {
                    resultsHTML += '<div class="result-warning">ID Duplikat:</div>';
                    duplicateGroups.forEach(groupId => {
                        resultsHTML += `<div class="result-item result-warning">${groupId}: Sudah ada dalam daftar</div>`;
                    });
                }
                
                if (validCount > 0) {
                    resultsHTML += '<div class="result-success">ID Valid:</div>';
                    validGroups.forEach(groupId => {
                        resultsHTML += `<div class="result-item result-success">${groupId}: Siap ditambahkan</div>`;
                    });
                }
                
                document.getElementById('bulkResultsContent').innerHTML = resultsHTML;
            } else {
                resultsElement.style.display = 'none';
            }
        }

        // ==================== FITUR BARU: Filter dan Pencarian ====================
        function applyFiltersAndSort() {
            // Filter berdasarkan pencarian
            if (searchQuery) {
                filteredGroups = groups.filter(group => 
                    group.id.toLowerCase().includes(searchQuery.toLowerCase())
                );
            } else {
                filteredGroups = [...groups];
            }
            
            // Filter berdasarkan status
            if (statusFilter !== 'all') {
                if (statusFilter === 'active' || statusFilter === 'inactive') {
                    filteredGroups = filteredGroups.filter(group => group.status === statusFilter);
                } else if (statusFilter === 'valid') {
                    filteredGroups = filteredGroups.filter(group => group.isValid);
                } else if (statusFilter === 'invalid') {
                    filteredGroups = filteredGroups.filter(group => !group.isValid);
                }
            }
            
            // Sort berdasarkan kriteria
            if (sortBy === 'id') {
                filteredGroups.sort((a, b) => a.id.localeCompare(b.id));
            } else if (sortBy === 'status') {
                filteredGroups.sort((a, b) => {
                    if (a.status === b.status) return 0;
                    return a.status === 'active' ? -1 : 1;
                });
            } else if (sortBy === 'lastResult') {
                filteredGroups.sort((a, b) => a.lastResult.localeCompare(b.lastResult));
            }
            
            // Reset ke halaman pertama setelah filter
            currentPage = 1;
        }

        // ==================== FITUR BARU: Pagination ====================
        function setupPagination() {
            const paginationElement = document.getElementById('pagination');
            const pageCount = Math.ceil(filteredGroups.length / itemsPerPage);
            
            if (pageCount <= 1) {
                paginationElement.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Tombol Previous
            paginationHTML += `
                <button class="pagination-btn" id="prevPage" ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            // Tombol halaman
            for (let i = 1; i <= pageCount; i++) {
                paginationHTML += `
                    <button class="pagination-btn ${i === currentPage ? 'active' : ''}" data-page="${i}">
                        ${i}
                    </button>
                `;
            }
            
            // Tombol Next
            paginationHTML += `
                <button class="pagination-btn" id="nextPage" ${currentPage === pageCount ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            paginationElement.innerHTML = paginationHTML;
            
            // Event listeners untuk pagination
            document.getElementById('prevPage').addEventListener('click', () => {
                if (currentPage > 1) {
                    currentPage--;
                    populateGroupsTable();
                    setupPagination();
                }
            });
            
            document.getElementById('nextPage').addEventListener('click', () => {
                if (currentPage < pageCount) {
                    currentPage++;
                    populateGroupsTable();
                    setupPagination();
                }
            });
            
            document.querySelectorAll('.pagination-btn[data-page]').forEach(btn => {
                btn.addEventListener('click', () => {
                    currentPage = parseInt(btn.getAttribute('data-page'));
                    populateGroupsTable();
                    setupPagination();
                });
            });
        }

        // ==================== EVENT LISTENERS YANG DIPERBAIKI ====================

        // Login Functionality
        document.getElementById('loginBtn').addEventListener('click', function() {
            const password = document.getElementById('password').value;
            const correctPassword = "xiaogui";
            
            if (password === correctPassword) {
                document.getElementById('loginModal').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                initializeData();
                showNotification('Login berhasil!');
            } else {
                showNotification('Password salah! Silakan coba lagi.', true);
            }
        });

        // Allow login with Enter key
        document.getElementById('password').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('loginBtn').click();
            }
        });

        // Event listeners untuk validasi real-time
        document.getElementById('botId').addEventListener('input', validateBotConfig);
        document.getElementById('botToken').addEventListener('input', validateBotConfig);
        
        // PERBAIKAN: Validasi real-time untuk single group
        document.getElementById('newGroupId').addEventListener('input', validateSingleGroup);
        
        // PERBAIKAN: Validasi real-time untuk multi group
        document.getElementById('multiGroupIds').addEventListener('input', validateMultiGroups);

        // Save configuration
        document.getElementById('saveConfigBtn').addEventListener('click', function() {
            validateBotConfig();
            
            if (!botConfig.isValid) {
                showNotification('Konfigurasi bot tidak valid! Periksa ID dan Token.', true);
                return;
            }

            saveConfig();
            showNotification('Konfigurasi bot berhasil disimpan!');
            runDiagnosis();
        });

        // Test connection
        document.getElementById('testConnectionBtn').addEventListener('click', testBotConnection);

        // ==================== FITUR BARU: Event Listeners untuk Filter dan Pencarian ====================
        document.getElementById('searchInput').addEventListener('input', function() {
            searchQuery = this.value;
            applyFiltersAndSort();
            populateGroupsTable();
            setupPagination();
        });

        document.getElementById('statusFilter').addEventListener('change', function() {
            statusFilter = this.value;
            applyFiltersAndSort();
            populateGroupsTable();
            setupPagination();
        });

        document.getElementById('sortBy').addEventListener('change', function() {
            sortBy = this.value;
            applyFiltersAndSort();
            populateGroupsTable();
            setupPagination();
        });

        // Refresh button
        document.getElementById('refreshBtn').addEventListener('click', function() {
            showNotification('Status grup diperbarui!');
            runDiagnosis();
        });

        // Populate groups table
        function populateGroupsTable() {
            const tableBody = document.getElementById('groupsTableBody');
            tableBody.innerHTML = '';
            
            if (filteredGroups.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" style="text-align: center; padding: 30px;">
                        <i class="fas fa-inbox" style="font-size: 2rem; margin-bottom: 10px; display: block; opacity: 0.5;"></i>
                        Tidak ada grup yang sesuai dengan filter.
                    </td>
                `;
                tableBody.appendChild(row);
                return;
            }
            
            // Hitung indeks untuk pagination
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = Math.min(startIndex + itemsPerPage, filteredGroups.length);
            const currentGroups = filteredGroups.slice(startIndex, endIndex);
            
            currentGroups.forEach((group, index) => {
                const row = document.createElement('tr');
                const validityStatus = group.isValid ? 
                    '<span class="status valid">Valid</span>' : 
                    '<span class="status invalid">Tidak Valid</span>';
                
                const lastResult = group.lastResult ? 
                    `<span style="color: ${group.lastResult.includes('Berhasil') ? '#00ff00' : '#ff4444'}">${group.lastResult}</span>` : 
                    '-';
                
                row.innerHTML = `
                    <td>${group.id}</td>
                    <td>${validityStatus}</td>
                    <td><span class="status ${group.status}">${group.status === 'active' ? 'Aktif' : 'Tidak Aktif'}</span></td>
                    <td>${lastResult}</td>
                    <td>
                        <button class="delete-btn" data-id="${group.id}">
                            <i class="fas fa-trash"></i> Hapus
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const groupId = this.getAttribute('data-id');
                    deleteGroup(groupId);
                });
            });
        }

        // Delete group
        function deleteGroup(groupId) {
            if (confirm(`Apakah Anda yakin ingin menghapus grup ${groupId}?`)) {
                const groupIndex = groups.findIndex(group => group.id === groupId);
                if (groupIndex !== -1) {
                    groups.splice(groupIndex, 1);
                    saveGroups();
                    applyFiltersAndSort();
                    updateGroupsCount();
                    populateGroupsTable();
                    setupPagination();
                    showNotification(`Grup ${groupId} berhasil dihapus.`);
                    runDiagnosis();
                }
            }
        }

        // ==================== FUNGSI TAMBAH GRUP YANG DIPERBAIKI ====================

        // Add group functionality
        document.getElementById('addGroupBtn').addEventListener('click', function() {
            document.getElementById('addGroupForm').style.display = 'block';
            document.getElementById('multiAddGroupForm').style.display = 'none';
            document.getElementById('newGroupId').value = '';
            document.getElementById('newGroupIdStatus').innerHTML = '<i class="fas fa-question-circle"></i>';
            document.getElementById('singleGroupValidation').style.display = 'none';
            document.getElementById('singleGroupPreview').style.display = 'none';
        });

        document.getElementById('multiAddGroupBtn').addEventListener('click', function() {
            document.getElementById('multiAddGroupForm').style.display = 'block';
            document.getElementById('addGroupForm').style.display = 'none';
            document.getElementById('multiGroupIds').value = '';
            document.getElementById('multiGroupValidation').style.display = 'none';
            document.getElementById('multiGroupPreview').style.display = 'none';
            document.getElementById('bulkResults').style.display = 'none';
        });

        document.getElementById('cancelAddBtn').addEventListener('click', function() {
            document.getElementById('addGroupForm').style.display = 'none';
            document.getElementById('newGroupId').value = '';
        });

        document.getElementById('cancelMultiAddBtn').addEventListener('click', function() {
            document.getElementById('multiAddGroupForm').style.display = 'none';
            document.getElementById('multiGroupIds').value = '';
        });

        // PERBAIKAN: Save single group dengan validasi yang lebih baik
        document.getElementById('saveGroupBtn').addEventListener('click', function() {
            const newGroupId = document.getElementById('newGroupId').value.trim();
            
            if (!newGroupId) {
                showNotification('ID Grup tidak boleh kosong!', true);
                return;
            }
            
            const validation = validateGroupId(newGroupId);
            if (!validation.isValid) {
                showNotification(`Gagal menambahkan grup: ${validation.message}`, true);
                return;
            }
            
            // Add new group
            groups.push({
                id: newGroupId,
                status: 'active',
                lastResult: '',
                isValid: true
            });
            
            saveGroups();
            applyFiltersAndSort();
            updateGroupsCount();
            populateGroupsTable();
            setupPagination();
            
            // Reset form
            document.getElementById('addGroupForm').style.display = 'none';
            document.getElementById('newGroupId').value = '';
            
            showNotification(`‚úÖ Grup ${newGroupId} berhasil ditambahkan!`);
            runDiagnosis();
        });

        // PERBAIKAN: Multi add group functionality yang lebih baik
        document.getElementById('saveMultiGroupBtn').addEventListener('click', function() {
            const multiGroupIdsText = document.getElementById('multiGroupIds').value.trim();
            
            if (!multiGroupIdsText) {
                showNotification('Masukkan ID grup terlebih dahulu!', true);
                return;
            }
            
            // Parse group IDs
            const groupIds = multiGroupIdsText.split(/[\s\n]+/).filter(id => id.trim() !== '');
            
            if (groupIds.length === 0) {
                showNotification('Tidak ada ID grup yang valid!', true);
                return;
            }
            
            let addedCount = 0;
            let duplicateCount = 0;
            let invalidCount = 0;
            const addedGroups = [];
            
            groupIds.forEach(groupId => {
                const trimmedId = groupId.trim();
                const validation = validateGroupId(trimmedId);
                
                if (validation.isValid) {
                    // Add new group
                    groups.push({
                        id: trimmedId,
                        status: 'active',
                        lastResult: '',
                        isValid: true
                    });
                    addedCount++;
                    addedGroups.push(trimmedId);
                } else if (validation.message.includes("sudah ada")) {
                    duplicateCount++;
                } else {
                    invalidCount++;
                }
            });
            
            if (addedCount > 0) {
                saveGroups();
                applyFiltersAndSort();
                updateGroupsCount();
                populateGroupsTable();
                setupPagination();
                
                let message = `‚úÖ Berhasil menambahkan ${addedCount} grup: ${addedGroups.join(', ')}`;
                if (duplicateCount > 0) message += ` | ${duplicateCount} duplikat diabaikan`;
                if (invalidCount > 0) message += ` | ${invalidCount} invalid diabaikan`;
                
                showNotification(message);
            } else {
                showNotification('‚ùå Tidak ada grup yang berhasil ditambahkan. Semua ID invalid atau duplikat.', true);
            }
            
            // Reset form
            document.getElementById('multiAddGroupForm').style.display = 'none';
            document.getElementById('multiGroupIds').value = '';
            
            runDiagnosis();
        });

        // Send message functionality
        document.getElementById('sendBtn').addEventListener('click', async function() {
            const message = document.getElementById('message').value.trim();
            const sendBtn = document.getElementById('sendBtn');
            
            if (!message) {
                showNotification('Pesan tidak boleh kosong!', true);
                return;
            }
            
            if (!botConfig.isValid) {
                showNotification('Konfigurasi bot tidak valid!', true);
                return;
            }
            
            const activeGroups = groups.filter(group => group.status === 'active' && group.isValid);
            
            if (activeGroups.length === 0) {
                showNotification('Tidak ada grup aktif untuk dikirimi pesan!', true);
                return;
            }
            
            sendBtn.disabled = true;
            sendBtn.innerHTML = '<div class="loading-spinner"></div> Mengirim...';
            
            try {
                // Simulasi pengiriman pesan
                let successCount = 0;
                let failedCount = 0;
                
                for (let i = 0; i < activeGroups.length; i++) {
                    const group = activeGroups[i];
                    
                    // Simulasi delay pengiriman
                    await new Promise(resolve => setTimeout(resolve, 500));
                    
                    // Simulasi hasil pengiriman (80% success rate)
                    const isSuccess = Math.random() > 0.2;
                    
                    if (isSuccess) {
                        group.lastResult = 'Berhasil dikirim';
                        successCount++;
                    } else {
                        group.lastResult = 'Gagal mengirim';
                        failedCount++;
                    }
                    
                    // Update progress
                    const progress = Math.round(((i + 1) / activeGroups.length) * 100);
                    sendBtn.innerHTML = `<div class="loading-spinner"></div> Mengirim... ${progress}%`;
                }
                
                saveGroups();
                populateGroupsTable();
                
                showNotification(`Pesan berhasil dikirim ke ${successCount} grup, ${failedCount} gagal.`);
            } catch (error) {
                showNotification(`Terjadi error saat mengirim pesan: ${error.message}`, true);
            } finally {
                sendBtn.disabled = false;
                sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Kirim Pesan ke Semua Grup';
            }
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-focus password field
            document.getElementById('password').focus();
        });
    </script>
</body>
</html>
